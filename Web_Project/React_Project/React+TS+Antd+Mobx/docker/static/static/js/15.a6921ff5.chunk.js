(this["webpackJsonpreact-antd-admin"]=this["webpackJsonpreact-antd-admin"]||[]).push([[15],{244:function(e,t,n){"use strict";n.d(t,"e",(function(){return a})),n.d(t,"b",(function(){return r})),n.d(t,"d",(function(){return o})),n.d(t,"f",(function(){return s})),n.d(t,"c",(function(){return l})),n.d(t,"a",(function(){return c}));var i=n(57),a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return Object(i.a)({url:"/admin/role/list",params:{page:e}})},r=function(e){return Object(i.a)({url:"/admin/role/delete/"+e,method:"delete"})},o=function(e){return Object(i.a)({url:"/admin/role/detail/"+e})},s=function(e,t,n){return Object(i.a)({url:"/admin/role/update/"+e,method:"put",data:{roleName:t,permissionList:n}})},l=function(){return Object(i.a)({url:"/admin/role/all"})},c=function(e){return Object(i.a)({url:"/admin/role/add",method:"post",data:e})}},255:function(e,t,n){"use strict";var i,a=n(27),r=n(37),o=n(39),s=n(38),l=n(0),c=n(36),d=n(4),u=Object(c.b)("permission")(i=Object(c.c)(i=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(){var e;Object(a.a)(this,n);for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).checkPermission=function(t){var n;return!!e.props.permission&&(null===(n=e.props.permission)||void 0===n?void 0:n.getPermissionList().filter((function(t){return t.path===e.props.path})).length)>0},e}return Object(r.a)(n,[{key:"render",value:function(){return Object(d.jsx)(d.Fragment,{children:this.checkPermission(this.props.path)?this.props.children:null})}}]),n}(l.Component))||i)||i;t.a=u},479:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return A}));var i=n(27),a=n(37),r=n(39),o=n(38),s=n(0),l=n.n(s),c=n(244),d=n(42),u=n(465),h=n(354),f=n(117),p=n(353),b=n(4),j=function(e){Object(r.a)(n,e);var t=Object(o.a)(n);function n(){var e;Object(i.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).confirm=function(){Object(c.b)(e.props.role.id).then((function(t){var n=t.data,i=n.code,a=n.msg;0===i?(f.b.success("\u5220\u9664\u6210\u529f\uff01"),e.props.callback(e.props.role)):f.b.warn(a)}))},e.cancel=function(){f.b.info("\u4f60\u53d6\u6d88\u4e86\u5220\u9664\uff01")},e}return Object(a.a)(n,[{key:"render",value:function(){return Object(b.jsx)(b.Fragment,{children:Object(b.jsx)(p.a,{title:"\u4f60\u786e\u5b9a\u8981\u5220\u9664\u7528\u6237\u5417\uff1f\u5220\u9664\u540e\u4e0d\u53ef\u4ee5\u6062\u590d\uff01",okText:"\u5220\u9664",placement:"topRight",onConfirm:this.confirm,onCancel:this.cancel,cancelText:"\u53d6\u6d88",children:Object(b.jsx)(d.a,{type:"primary",danger:!0,children:"\u5220\u9664"})})})}}]),n}(s.Component),m=n(107),v=n(160),O=n(468),g=n(471),x=n(467),y={wrapperCol:{offset:8,span:16}},C={labelCol:{span:6},wrapperCol:{span:16}},L=function(e){Object(r.a)(n,e);var t=Object(o.a)(n);function n(e,a){var r;return Object(i.a)(this,n),(r=t.call(this,e,a)).formRef=void 0,r.handleCancel=function(){r.setState({nodeList:[],defaultCheckedKeys:[],defaultExpandedKeys:[],defaultSelectedKeys:[]}),r.props.callback(!1)},r.saveRole=function(e){var t;e.id=null===(t=r.props.role)||void 0===t?void 0:t.id,Object(c.f)(e.id,e.roleName,e.permissionList).then((function(t){var n,i=t.data,a=i.code,o=i.msg;0===a?(r.props.saveRole({id:e.id,roleName:e.roleName,createdAt:null===(n=r.props.role)||void 0===n?void 0:n.createdAt}),f.b.success(o)):f.b.warn(o)}))},r.generatePermissionList=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=[];return e.forEach((function(i){i.parentId===t&&(i.key=i.id,i.children=r.generatePermissionList(e,i.id),n.push(i))})),n},r.loadPermission=function(){var e;Object(c.d)(null===(e=r.props.role)||void 0===e?void 0:e.id).then((function(e){var t;if(0===e.data.code){var n=e.data.data,i=n.permissionList,a=n.permissionAll,o=i.map((function(e){return e.id}));r.setState({nodeList:r.generatePermissionList(a),defaultCheckedKeys:o}),null===(t=r.formRef.current)||void 0===t||t.setFieldsValue({permissionList:o})}}))},r.componentDidUpdate=function(e,t,n){e.visible||r.props.role&&0===t.nodeList.length&&r.loadPermission()},r.onCheck=function(e,t){var n;null===(n=r.formRef.current)||void 0===n||n.setFieldsValue({permissionList:e.checked})},r.formRef=l.a.createRef(),r.state={nodeList:[],defaultCheckedKeys:[],defaultExpandedKeys:[],defaultSelectedKeys:[]},r}return Object(a.a)(n,[{key:"render",value:function(){var e;return null===(e=this.formRef.current)||void 0===e||e.setFieldsValue(Object(m.a)({},this.props.role)),Object(b.jsx)(b.Fragment,{children:Object(b.jsx)(v.a,{visible:this.props.visible,title:"\u7f16\u8f91\u7528\u6237\u4fe1\u606f",onCancel:this.handleCancel,cancelText:"\u53d6\u6d88",okText:"\u786e\u8ba4",footer:null,children:Object(b.jsxs)(O.a,Object(m.a)(Object(m.a)({},C),{},{ref:this.formRef,onFinish:this.saveRole,initialValues:Object(m.a)(Object(m.a)({},this.props.role),{},{permissionList:[]}),children:[Object(b.jsx)(O.a.Item,{label:"\u7f16\u8f91\u89d2\u8272\u4fe1\u606f",name:"roleName",rules:[{required:!0,message:"\u89d2\u8272\u540d\u79f0\u4e0d\u53ef\u4ee5\u4e3a\u7a7a"}],shouldUpdate:function(e,t){return e.additional!==t.additional},children:Object(b.jsx)(g.a,{})}),this.state.nodeList.length>0?Object(b.jsx)(O.a.Item,{name:"permissionList",label:"\u9009\u62e9\u6743\u9650",rules:[{type:"array",min:1,required:!0,validator:function(e,t){return t.length<=0?Promise.reject("\u81f3\u5c11\u8981\u9009\u62e9\u4e00\u4e2a\u6743\u9650\uff01"):Promise.resolve()}}],shouldUpdate:function(e,t){return e.additional!==t.additional},children:Object(b.jsx)(x.a,{defaultExpandAll:!0,checkStrictly:!0,showLine:!0,checkable:!0,treeData:this.state.nodeList,defaultCheckedKeys:this.state.defaultCheckedKeys,onCheck:this.onCheck})}):null,Object(b.jsx)(O.a.Item,Object(m.a)(Object(m.a)({},y),{},{children:Object(b.jsx)(h.b,{children:Object(b.jsx)(d.a,{type:"primary",htmlType:"submit",children:"\u63d0\u4ea4"})})}))]}))})})}}]),n}(s.Component),k=n(255),R=n(147),S={wrapperCol:{offset:8,span:16}},w={labelCol:{span:4},wrapperCol:{span:16}},P=function(e){Object(r.a)(n,e);var t=Object(o.a)(n);function n(e,a){var r;return Object(i.a)(this,n),(r=t.call(this,e,a)).formRef=void 0,r.cancel=function(){var e;null===(e=r.formRef.current)||void 0===e||e.resetFields(),r.props.cancel()},r.addRole=function(e){Object(c.a)(e).then((function(e){var t=e.data,n=t.msg;0===t.code?(f.b.success(n),r.props.cancel(!0)):f.b.error(n)}))},r.getAllPermission=function(){Object(R.b)().then((function(e){var t=e.data.data;r.setState({nodeList:r.generatePermissionList(t)})}))},r.generatePermissionList=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=[];return e.forEach((function(i){i.parentId===t&&(i.key=i.id,i.children=r.generatePermissionList(e,i.id),n.push(i))})),n},r.onCheck=function(e,t){var n;null===(n=r.formRef.current)||void 0===n||n.setFieldsValue({permissionList:e.checked})},r.reset=function(){var e;null===(e=r.formRef.current)||void 0===e||e.resetFields()},r.formRef=l.a.createRef(),r.state={nodeList:[]},r}return Object(a.a)(n,[{key:"componentDidUpdate",value:function(e,t,n){e.visible||0!==t.nodeList.length||this.getAllPermission()}},{key:"render",value:function(){return Object(b.jsx)(b.Fragment,{children:Object(b.jsx)(v.a,{title:"\u6dfb\u52a0\u89d2\u8272",visible:this.props.visible,onCancel:this.cancel,footer:null,children:Object(b.jsxs)(O.a,Object(m.a)(Object(m.a)({ref:this.formRef},w),{},{onFinish:this.addRole,onReset:this.reset,initialValues:{roleName:"",permissionList:[]},children:[Object(b.jsx)(O.a.Item,{label:"\u89d2\u8272\u540d\u79f0",name:"roleName",rules:[{type:"string",required:!0,message:"\u89d2\u8272\u540d\u79f0\u4e0d\u53ef\u4ee5\u4e3a\u7a7a"}],children:Object(b.jsx)(g.a,{})}),Object(b.jsx)(O.a.Item,{name:"permissionList",rules:[{type:"array",min:1,required:!0,validator:function(e,t){return t.length<=0?Promise.reject("\u81f3\u5c11\u8981\u9009\u62e9\u4e00\u4e2a\u6743\u9650\uff01"):Promise.resolve()}}],label:"\u6743\u9650",children:Object(b.jsx)(x.a,{defaultExpandAll:!0,checkStrictly:!0,showLine:!0,checkable:!0,treeData:this.state.nodeList,onCheck:this.onCheck})}),Object(b.jsx)(O.a.Item,Object(m.a)(Object(m.a)({},S),{},{children:Object(b.jsxs)(h.b,{children:[Object(b.jsx)(d.a,{type:"primary",htmlType:"submit",children:"\u63d0\u4ea4"}),Object(b.jsx)(d.a,{type:"default",htmlType:"reset",children:"\u91cd\u7f6e"})]})}))]}))})})}}]),n}(s.Component),A=function(e){Object(r.a)(n,e);var t=Object(o.a)(n);function n(e,a){var r;return Object(i.a)(this,n),(r=t.call(this,e,a)).getRoleList=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;r.setState({loading:!0}),Object(c.e)(e).then((function(e){var t=e.data.data,n=t.currentPage,i=t.dataList,a=t.totalCount,o=t.limit;r.setState({page:n,roleList:i,totalCount:a,pageSize:o,loading:!1})}))},r.deleteRole=function(e){r.setState({roleList:r.state.roleList.filter((function(t){return t.id!==e.id}))})},r.callback=function(e){r.setState((function(){return{visible:e}}))},r.show=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];r.setState((function(){return{visible:t,role:e}}))},r.saveRole=function(e){r.setState((function(t){return{visible:!1,roleList:t.roleList.map((function(t){return t.id===(null===e||void 0===e?void 0:e.id)?e:t})),role:e}}))},r.onChange=function(e){r.getRoleList(e)},r.showAddRoleModal=function(){r.setState({isShowAddRoleModal:!0})},r.cancelAddRoleModal=function(e){r.setState({isShowAddRoleModal:!1}),e&&r.getRoleList()},r.state={roleList:[],page:1,totalCount:0,pageSize:15,visible:!1,loading:!0,isShowAddRoleModal:!1},r}return Object(a.a)(n,[{key:"componentDidMount",value:function(){this.getRoleList()}},{key:"render",value:function(){var e=this;return Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)(d.a,{type:"primary",onClick:this.showAddRoleModal,children:"\u6dfb\u52a0\u89d2\u8272"}),Object(b.jsx)(P,{visible:this.state.isShowAddRoleModal,cancel:this.cancelAddRoleModal}),Object(b.jsx)(L,{visible:this.state.visible,role:this.state.role,callback:this.callback,saveRole:this.saveRole}),Object(b.jsxs)(u.a,{loading:this.state.loading,dataSource:this.state.roleList,pagination:{position:["bottomCenter"],total:this.state.totalCount,hideOnSinglePage:!0,defaultCurrent:this.state.page,defaultPageSize:this.state.pageSize,showSizeChanger:!1,onChange:this.onChange},rowKey:"id",children:[Object(b.jsx)(u.a.Column,{title:"id",dataIndex:"id"}),Object(b.jsx)(u.a.Column,{title:"\u89d2\u8272\u540d\u79f0",dataIndex:"roleName"}),Object(b.jsx)(u.a.Column,{title:"\u521b\u5efa\u65f6\u95f4",dataIndex:"createdAt"}),Object(b.jsx)(u.a.Column,{title:"\u7ba1\u7406",render:function(t){return Object(b.jsxs)(h.b,{children:[Object(b.jsx)(k.a,{path:"editRole",children:Object(b.jsx)(d.a,{type:"primary",onClick:function(){e.show(t,!0)},children:"\u7f16\u8f91"})}),Object(b.jsx)(k.a,{path:"deleteRole",children:Object(b.jsx)(j,{role:t,callback:e.deleteRole})})]})}})]})]})}}]),n}(s.Component)}}]);
//# sourceMappingURL=15.a6921ff5.chunk.js.map